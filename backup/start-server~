#!/usr/bin/env python
import sys
import argparse
import logging
import os
from subprocess import call

logging.basicConfig(level=logging.DEBUG,
                    stream=sys.stdout,
                    format="%(asctime)s [%(levelname)s] pid(%(process)d):thr(%(thread)d): %(message)s")

from AlmachBuildLibraryServer import app

parser = argparse.ArgumentParser("rampart-db-webui")
parser.add_argument('host', default='127.0.0.1')
parser.add_argument('-p', '--port', type=int, default=5001)
parser.add_argument('--use-debug-toolbar', action='store_true', default=False)
args = parser.parse_args()

app.config['DEBUG'] = True

if args.use_debug_toolbar:
    from flask_debugtoolbar import DebugToolbarExtension
    DebugToolbarExtension(app)

host=args.host
port=args.port

newpid = os.fork()
if newpid == 0:
    print "PID", os.getpid()
    #call(['sudo', 'docker', 'start', 'sharp_bell'])
    os._exit(0)  
else:
    print "PID", os.getpid()
    app.run(debug=True, host=host, port=port)
